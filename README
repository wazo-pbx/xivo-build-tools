
Installation
============


Update sources files for APT
----------------------------

   In your /etc/apt/source.list.d/<dist_name>.list:

$ cat >/etc/apt/source.list.d/<dist_name>.list <<EOL
deb http://mirror.lan-quebec.avencall.com/ <dist_name> main
deb-src http://mirror.lan-quebec.avencall.com/ <dist_name> main
EOL

$ wget http://mirror.lan-quebec.avencall.com/key.asc

$ apt-key add key.asc

$ apt-get update

$ apt-get install xivo-build-tools


Initialisation
--------------

$ ssh builder-squeeze

$ su -l builder

$ xivo-build-tools -i -a

$ ll ~/packages


Documentation
=============

You have to provide some informations to allow building:

    Usage: xivo-build-tools [OPTION]...

    Options
    -i: Package initialization for the first time, can be used later 
        to refresh the package and put them all to date.
    -d: distribution_name (default: squeeze-xivo-skaro-dev)
    -b: branch_name (default: master)
    -a: Processing all package
    -p: Processing only one specified package name
    -f: Force rebuild package
    -v: Set xivo version (Default is in /etc/xivo-build-tools/xivo-build-tools.conf)
    -h: show this help


Specifications
==============

Nom des branches pour un test automatique:

auto-[1-5]-<branch_name>

Les paquets se trouvent sur "mirror.lan-quebec.avencall.com"
dans le repertoire /home/builder/packages
Attention a bien etre avec l'utilisateur <builder> avant de 
lancer une commande dans ce repertoire.


Example
=======

Various
-------

Initialize all package

 $ xivo-build-tools -i -a


Initialize or update only xivo-agid package

 $ xivo-build-tools -i -p xivo-agid


Build xivo-web-interface package for squeeze-xivo-skaro-dev distribution

 $ xivo-build-tools -d squeeze-xivo-skaro-dev -p xivo-web-interface


Build xivo-agent package for test distribution, force rebuild and force xivo-version

 $ xivo-build-tools -d test -f -v 13.11 -p xivo-agent


Build all packages for test distribution, force rebuild and force xivo-version

 $ xivo-build-tools -d test -a -f -v 13.11


Use xivo-test-X
---------------

Je veux construire le paquet "xivo-web-interface" sur la machine xivo-test-1


 $ cd xivo-web-interface

 $ git checkout -b auto-1-test_autobuildtools

 $ touch lol

 $ git add lol

 $ git commit -m'test_autobuildtools'

 $ git push --set-upstream origin auto-1-test_autobuildtools


 $ ssh builder-squeeze

 $ su builder

 $ xivo-build-tools -p xivo-web-interface -d xivo-test-1

 $ xivo-build-tools -p xivo-config -d xivo-test-1


 $ ssh mirror.lan-quebec.avencall.com

 $ reprepro -Vb /srv/reprepro processincoming xivo-test-1


 $ ssh xivo-test-1.lan-quebec.avencall.com

 $ xivo-upgrade
